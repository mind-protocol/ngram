### docs/connectome/node_kit/PATTERNS_Connectome_Node_Kit_Typed_Language_Coded_Energy_Aware_Node_Rendering_Patterns.md

$$$

# node_kit — Patterns: Typed, Language-Coded, Energy-Aware Node Rendering

STATUS: DRAFT
CREATED: 2025-12-20
VERIFIED: 2025-12-20 against ?
$$$

---

## CHAIN

$$$
THIS:            PATTERNS_Connectome_Node_Kit_Typed_Language_Coded_Energy_Aware_Node_Rendering_Patterns.md (you are here)
BEHAVIORS:       ./BEHAVIORS_Connectome_Node_Kit_Visible_Clarity_And_Trust_Effects.md
ALGORITHM:       ./ALGORITHM_Connectome_Node_Kit_Node_Rendering_Spec_And_Energy_Glow_Mapping.md
VALIDATION:      ./VALIDATION_Connectome_Node_Kit_Invariants_For_Node_Readability_And_State_Reflection.md
IMPLEMENTATION:  ./IMPLEMENTATION_Connectome_Node_Kit_Component_Map_And_Styling_Tokens.md
HEALTH:          ./HEALTH_Connectome_Node_Kit_Runtime_Verification_Of_Node_State_And_Visual_Signal_Truth.md
SYNC:            ./SYNC_Connectome_Node_Kit_Sync_Current_State.md
$$$

### Bidirectional Contract

$$$
Before modifying this doc or the code:

1. Read ALL docs in this chain
2. Read state_store + event_model chains (node_kit renders their semantics)

After modifying this doc:

* Update implementation OR record mismatch in SYNC

After modifying the code:

* Update docs OR record mismatch in SYNC

Never degrade:

* node readability at zoom=1.0
* correct reflection of active_focus and step_key
* energy display truthfulness (colors correspond to values)
  $$$

---

## THE PROBLEM

/connectome nodes must do three jobs simultaneously:

1. **Identify what the node is** (player vs UI vs module vs graph entity vs agent)
2. **Communicate how it behaves** (typed steps inside the node that highlight one-by-one)
3. **Show live quantitative signals** (energy, wait progress, tick cron fill) without clutter

Failure modes we already hit:

* nodes look too similar → cognitive blur
* file paths dominate titles → the wrong thing is salient
* energy numbers don’t “feel” like energy → no immediate intuition
* active focus does not clearly illuminate the active function in the node
* “graph links” accidentally look like nodes (must be avoided)

---

## THE PATTERN

**Typed node variants + consistent internal step list + truthful signal widgets.**

Node rendering is treated as a kit:

* a small set of node variants
* each variant has stable layout rules
* internal “steps list” exists where relevant, and highlights one step at a time
* quantitative signals (energy, wait, cron) render consistently everywhere

Key insight:

> The map is only as understandable as its nodes.
> Node identity must be immediate even before you read labels.

---

## PRINCIPLES

### Principle 1: Title is what matters; path is discreet

* Node **title** is prominent and colored
* Node **file path** is small, low-contrast, non-bold
* Node should be readable from “title only” at zoom=1.0

### Principle 2: Node background reflects type and language

We must visually distinguish:

* PLAYER vs UI (different nodes)
* TS/React vs PY/FastAPI
* Graph entities vs Moments vs Agents

This reduces “where am I?” errors.

### Principle 3: Energy is a first-class signal

Energy display must:

* be legible
* map color to value (grey → blue → orange → yellow)
* optionally pulse glow when energy changes
* make magnitude feel real without requiring reading numbers

### Principle 4: Active step highlight is precise and singular

Within a node:

* only the current step_key is highlighted
* previous step does not remain highlighted
* highlight is bold + colored by call type (owned by event_model semantics)

### Principle 5: Agent nodes are explicit and separate

We always show separate nodes:

* `LLM CLI Agent — Narrator`
* `LLM CLI Agent — World Builder`

No combined “LLM” blob.

---

## NODE TYPES (V1)

### Primary nodes

* `PlayerNode` — the human player entity (click to “send message” in stepper)
* `UiNode` — FE UI elements (buttons, hooks) distinct from player
* `ModuleNode` — backend/frontend modules (TS/PY-coded)
* `GraphQueriesNode` — graph read operations (purple-coded)
* `MomentNode` — moment entity (yellow-coded)
* `AgentNode` — each agent separately (green-coded)
* `TickCronNode` — physics tick wait/cron circle (speed-coded)

### Non-nodes (explicitly excluded)

* Graph link entities should NOT be rendered as card nodes in v1.

  * Graph links are edges (edge_kit).
  * If needed, show a fuzzy halo at edge midpoint (edge_kit responsibility).

---

## DEPENDENCIES

| Module        | Why                                                    |
| ------------- | ------------------------------------------------------ |
| `state_store` | provides node states, energy values, wait/tick signals |
| `event_model` | provides callType and step_key semantics for coloring  |
| `flow_canvas` | places nodes; node_kit renders them                    |
| `edge_kit`    | link visuals; node_kit must not duplicate them         |

---

## SCOPE

### In Scope

* node background rules by type + language
* internal step list rendering + active step highlighting
* energy badge formatting + gradient glow mapping
* wait progress bar widget in PlayerNode
* tick cron widget in TickCronNode
* “flipped” node glow (when a flip/interrupt is present) (source = FlowEvent notes or store signal ?)

### Out of Scope

* pan/zoom and zones (flow_canvas)
* edge styling and pulses (edge_kit)
* event normalization (event_model)
* step authorization and timing (runtime_engine)

---

## GAPS / IDEAS / QUESTIONS

* [ ] Define “flipped node” signal source (FlowEvent flag? derived from backend event?) → `?`
* QUESTION: Do we show node “language” as a badge (TS/PY) or infer from background only? (prefer: both, subtle)
* IDEA: Add a “pin node focus” affordance (but state_store must own pinning policy).

---

---

### docs/connectome/node_kit/BEHAVIORS_Connectome_Node_Kit_Visible_Clarity_And_Trust_Effects.md

$$$

# node_kit — Behaviors: Visible Clarity and Trust Effects

STATUS: DRAFT
CREATED: 2025-12-20
VERIFIED: 2025-12-20 against ?
$$$

---

## CHAIN

$$$
PATTERNS:        ./PATTERNS_Connectome_Node_Kit_Typed_Language_Coded_Energy_Aware_Node_Rendering_Patterns.md
THIS:            BEHAVIORS_Connectome_Node_Kit_Visible_Clarity_And_Trust_Effects.md (you are here)
ALGORITHM:       ./ALGORITHM_Connectome_Node_Kit_Node_Rendering_Spec_And_Energy_Glow_Mapping.md
VALIDATION:      ./VALIDATION_Connectome_Node_Kit_Invariants_For_Node_Readability_And_State_Reflection.md
IMPLEMENTATION:  ./IMPLEMENTATION_Connectome_Node_Kit_Component_Map_And_Styling_Tokens.md
HEALTH:          ./HEALTH_Connectome_Node_Kit_Runtime_Verification_Of_Node_State_And_Visual_Signal_Truth.md
SYNC:            ./SYNC_Connectome_Node_Kit_Sync_Current_State.md
$$$

---

## BEHAVIORS

### B1: Node identity is obvious at a glance

$$$
GIVEN:  the diagram is visible at zoom=1.0
THEN:   a user can instantly distinguish Player vs UI vs Module vs Graph vs Agent nodes
BECAUSE: backgrounds and title styling encode type and language
$$$

### B2: The title leads; file path is secondary

$$$
GIVEN:  a node shows a title and a file path
THEN:   the title is prominent and colored
AND:    the path is small, discreet, and not bold
$$$

### B3: Active step inside a node is clearly highlighted, one-at-a-time

$$$
GIVEN:  a FlowEvent specifies step_key for a node
WHEN:   the step becomes active
THEN:   exactly one list item is highlighted (bold + colored by call type)
AND:    previous items revert when Next is clicked
$$$

### B4: Energy feels like energy

$$$
GIVEN:  a node has an energy value
THEN:   the energy badge glow reflects the value (grey→blue→orange→yellow)
AND:    energy changes cause a brief glow accent (optional)
$$$

### B5: Wait progress bar is truthful and bounded

$$$
GIVEN:  player sent a message and no answer arrived
THEN:   PlayerNode shows a progress bar filling over max 4.0s with 0.1 precision seconds display
AND:    color shifts as it approaches max
$$$

### B6: Tick cron node communicates pacing without requiring reading

$$$
GIVEN:  speed is pause/1x/2x/3x
THEN:   TickCronNode shows a circular fill aligned to nominal tick interval
AND:    center shows speed label
AND:    color changes with speed
$$$

### B7: “Flipped” nodes are visually distinct

$$$
GIVEN:  a node is marked flipped/interrupt=true (source ?)
THEN:   it has a distinct glow ring so it “pops” from normal activation
$$$

---

## ANTI-BEHAVIORS

### A1: Node rendering re-implements event normalization

$$$
MUST NOT: infer callType/trigger from raw payload in node rendering
INSTEAD: consume callType/trigger/step_key already normalized/stored
$$$

### A2: Energy values displayed without consistent mapping

$$$
MUST NOT: show arbitrary colors for energy without mapping rule
INSTEAD: use deterministic mapping function from ALGORITHM
$$$

---

## EDGE CASES

### E1: Unknowns

$$$
GIVEN:  a node lacks language/type info
THEN:   it renders with default neutral styling and shows “?” in tooltip
$$$

---

## GAPS / IDEAS / QUESTIONS

* QUESTION: Do we display multiple energy metrics (energy, weight, salience) in v1? (recommend: energy only for now)

---

---

### docs/connectome/node_kit/ALGORITHM_Connectome_Node_Kit_Node_Rendering_Spec_And_Energy_Glow_Mapping.md

$$$

# node_kit — Algorithm: Node Rendering Spec and Energy Glow Mapping

STATUS: DRAFT
CREATED: 2025-12-20
VERIFIED: 2025-12-20 against ?
$$$

---

## CHAIN

$$$
PATTERNS:        ./PATTERNS_Connectome_Node_Kit_Typed_Language_Coded_Energy_Aware_Node_Rendering_Patterns.md
BEHAVIORS:       ./BEHAVIORS_Connectome_Node_Kit_Visible_Clarity_And_Trust_Effects.md
THIS:            ALGORITHM_Connectome_Node_Kit_Node_Rendering_Spec_And_Energy_Glow_Mapping.md (you are here)
VALIDATION:      ./VALIDATION_Connectome_Node_Kit_Invariants_For_Node_Readability_And_State_Reflection.md
IMPLEMENTATION:  ./IMPLEMENTATION_Connectome_Node_Kit_Component_Map_And_Styling_Tokens.md
HEALTH:          ./HEALTH_Connectome_Node_Kit_Runtime_Verification_Of_Node_State_And_Visual_Signal_Truth.md
SYNC:            ./SYNC_Connectome_Node_Kit_Sync_Current_State.md
$$$

---

## OVERVIEW

Node rendering is deterministic: given node model + store state, it produces consistent visuals.

Inputs:

* node metadata: type, language, title, path, steps list, tooltip text
* state signals: active_focus, energy value, wait/tick progress, flipped flag (?)

Outputs:

* rendered node component with correct background, layout, highlighted step, and widgets

---

## DATA STRUCTURES

### `ConnectomeNodeViewModel`

$$$
ConnectomeNodeViewModel:
node_id: string
node_type:
Player|UI|Module|GraphQueries|Moment|Agent|TickCron
language: TS|PY|GRAPH|AGENT|UNKNOWN
title: string
file_path: string|null
steps:
- step_key: string
label: string
call_type: code|graphQuery|llm|graphLink|moment
energy_value: number|null
flipped: boolean|null
tooltip: {summary: string, notes: string|null}
$$$

---

## ALGORITHM: `render_node(view_model, store_state)`

### Step 1: Determine background theme

$$$
background_theme = theme_for(node_type, language)
$$$

Rules (v1):

* Player: distinct (warm neutral with accent)
* UI: distinct (cool grey/blue)
* Module TS: TS-blue background tint
* Module PY: PY-purple background tint
* GraphQueries: purple background tint
* Moment: yellow background tint
* Agent: green background tint
* TickCron: speed-coded tint

### Step 2: Title and path

* title rendered prominent, colored by node_type
* file_path rendered small, low contrast, not bold

### Step 3: Steps list (if present)

* render list of step labels
* active_step_key = store.active_focus.active_step_key
* if view_model has a matching step_key:

  * mark that item active (bold)
  * color it by its call_type (from view_model step definition)
* all others revert to normal

### Step 4: Energy badge

If energy_value exists:

* show value (format: 0.00 or 0.0 depending on scale; v1 choose 0.2 precision)
* compute energy_color = map_energy_to_color(energy_value)
* set glow accordingly

### Step 5: Widgets per node type

* PlayerNode:

  * show wait progress bar (value and seconds) from store selector
* TickCronNode:

  * show circular progress ring from store.tick_display.progress_0_1
  * center shows speed label

### Step 6: Flipped ring

If flipped==true:

* add outer ring glow with distinct color (e.g., pink/white) and stronger blur

---

## ALGORITHM: `map_energy_to_color(energy)`

Deterministic thresholds (v1 initial):

$$$
IF energy is null:
color = neutral_grey
ELSE IF energy < 0.10:
color = grey
ELSE IF energy < 0.30:
color = blue
ELSE IF energy < 0.60:
color = orange
ELSE:
color = yellow
$$$

Notes:

* thresholds can be tuned later but must remain deterministic
* mapping must be documented whenever changed

---

## ALGORITHM: wait progress display (PlayerNode)

Inputs from store selector:

* seconds_display: one decimal (0.0..4.0)
* value_0_1: 0..1

Color thresholds (v1):

* <1.0s green
* <2.0s yellow
* <3.0s orange
* else red

---

## COMPLEXITY

O(k) where k = number of steps in the node (small). Rendering is fast.

---

## GAPS / IDEAS / QUESTIONS

* [ ] Define exact title color tokens per node_type (shared palette file likely in node_kit).
* QUESTION: Is energy normalized 0..1 or unbounded? mapping assumes “small-ish”; mark `?` until telemetry defines it.
* IDEA: Show a tiny “TS/PY” badge in corner for Module nodes.

---

---

### docs/connectome/node_kit/VALIDATION_Connectome_Node_Kit_Invariants_For_Node_Readability_And_State_Reflection.md

$$$

# node_kit — Validation: Invariants for Readability and Correct State Reflection

STATUS: DRAFT
CREATED: 2025-12-20
VERIFIED: 2025-12-20 against ?
$$$

---

## CHAIN

$$$
PATTERNS:        ./PATTERNS_Connectome_Node_Kit_Typed_Language_Coded_Energy_Aware_Node_Rendering_Patterns.md
BEHAVIORS:       ./BEHAVIORS_Connectome_Node_Kit_Visible_Clarity_And_Trust_Effects.md
ALGORITHM:       ./ALGORITHM_Connectome_Node_Kit_Node_Rendering_Spec_And_Energy_Glow_Mapping.md
THIS:            VALIDATION_Connectome_Node_Kit_Invariants_For_Node_Readability_And_State_Reflection.md (you are here)
IMPLEMENTATION:  ./IMPLEMENTATION_Connectome_Node_Kit_Component_Map_And_Styling_Tokens.md
HEALTH:          ./HEALTH_Connectome_Node_Kit_Runtime_Verification_Of_Node_State_And_Visual_Signal_Truth.md
SYNC:            ./SYNC_Connectome_Node_Kit_Sync_Current_State.md
$$$

---

## INVARIANTS

### V1: Type and language styling is deterministic

$$$
Given (node_type, language):
background theme is stable and does not depend on render order
$$$

### V2: Title prominence invariant

$$$
Title is visually dominant over file_path:
title font size > path font size
path is not bold
$$$

### V3: Active step highlight singularity

$$$
At any time:
in a given node, at most one step is highlighted
if active_step_key does not match any step_key, none are highlighted
$$$

### V4: Energy mapping invariant

$$$
Given energy value e:
mapped color is deterministic per thresholds
glow intensity corresponds to bucket
$$$

### V5: Player wait progress bounded

$$$
Displayed wait seconds:
0.0 <= seconds <= 4.0
one decimal precision
$$$

### V6: Tick cron bounded

$$$
Tick progress:
0.0 <= progress_0_1 <= 1.0
Speed label matches store speed
$$$

---

## ERROR CONDITIONS

### E1: Multiple active steps highlighted

* severity: ERROR
* meaning: the “one function per step” debugging intent is broken

### E2: Energy color mapping inconsistent

* severity: WARN/ERROR depending on impact
* meaning: energy stops being interpretable

---

## HEALTH COVERAGE

| Validation | Health Indicator                        |
| ---------- | --------------------------------------- |
| V3         | node_active_step_singularity_integrity  |
| V4         | node_energy_color_bucket_integrity      |
| V5         | node_wait_progress_clamp_integrity      |
| V6         | node_tick_cron_progress_clamp_integrity |

---

## VERIFICATION PROCEDURE

### Manual

$$$
[ ] Step through events: each node highlights only one internal step at a time
[ ] Energy changes: badge glow changes bucket correctly
[ ] Wait bar never exceeds 4.0s and shows 0.1 precision
[ ] Cron ring stays within 0..1 and matches speed label
$$$

### Automated

$$$
pnpm connectome:health node_kit
$$$

---

## SYNC STATUS

$$$
LAST_VERIFIED: 2025-12-20
VERIFIED_AGAINST:
impl: ?
health: ?
RESULT:
V1..V6: NOT RUN
$$$

---

## GAPS / IDEAS / QUESTIONS

* QUESTION: Should we assert minimum contrast ratios (WCAG-ish) for title readability? (nice-to-have)

---

---

### docs/connectome/node_kit/HEALTH_Connectome_Node_Kit_Runtime_Verification_Of_Node_State_And_Visual_Signal_Truth.md

$$$

# node_kit — Health: Runtime Verification of Node Signal Truthfulness

STATUS: DRAFT
CREATED: 2025-12-20
$$$

---

## PURPOSE OF THIS FILE

node_kit HEALTH ensures that nodes do not lie:

* active step highlight matches store.active_focus
* energy mapping buckets match deterministic rules
* wait/tick widgets respect bounds and precision
* node identity styling remains deterministic

This is not an aesthetics judge; it verifies trust signals.

---

## CHAIN

$$$
PATTERNS:        ./PATTERNS_Connectome_Node_Kit_Typed_Language_Coded_Energy_Aware_Node_Rendering_Patterns.md
BEHAVIORS:       ./BEHAVIORS_Connectome_Node_Kit_Visible_Clarity_And_Trust_Effects.md
ALGORITHM:       ./ALGORITHM_Connectome_Node_Kit_Node_Rendering_Spec_And_Energy_Glow_Mapping.md
VALIDATION:      ./VALIDATION_Connectome_Node_Kit_Invariants_For_Node_Readability_And_State_Reflection.md
IMPLEMENTATION:  ./IMPLEMENTATION_Connectome_Node_Kit_Component_Map_And_Styling_Tokens.md
THIS:            HEALTH_Connectome_Node_Kit_Runtime_Verification_Of_Node_State_And_Visual_Signal_Truth.md
SYNC:            ./SYNC_Connectome_Node_Kit_Sync_Current_State.md

IMPL:            ? (planned) scripts/connectome/health/node_kit_health_check_runner.ts
$$$

---

## FLOWS ANALYSIS (TRIGGERS + FREQUENCY)

$$$
flows_analysis:

* flow_id: node_focus_highlight_updates
  purpose: ensure active step highlight matches store state
  triggers:

  * type: manual
    source: runtime_engine Next click
    frequency:
    expected_rate: "human driven"
    risks:
  * "multiple active steps"
  * "highlight stuck on previous step"

* flow_id: node_energy_display_updates
  purpose: ensure energy mapping is deterministic and bounded
  triggers:

  * type: event
    source: state_store energy updates (derived from FlowEvents)
    frequency:
    expected_rate: "per step in stepper; high in realtime"
    risks:
  * "bucket mismatch"
  * "unbounded energy values"
    $$$

---

## HEALTH INDICATORS SELECTED

$$$
health_indicators:

* name: node_active_step_singularity_integrity
  flow_id: node_focus_highlight_updates
  priority: high

* name: node_energy_color_bucket_integrity
  flow_id: node_energy_display_updates
  priority: med

* name: node_wait_progress_clamp_integrity
  flow_id: node_focus_highlight_updates
  priority: high

* name: node_tick_cron_progress_clamp_integrity
  flow_id: node_focus_highlight_updates
  priority: med
  $$$

---

## CHECKER INDEX

$$$
checkers:

* name: health_check_only_one_step_is_highlighted_per_node
  purpose: "Assert V3: singular highlight."
  status: pending
  priority: high

* name: health_check_energy_value_maps_to_correct_bucket
  purpose: "Assert V4: energy->color mapping correct."
  status: pending
  priority: med

* name: health_check_wait_progress_seconds_bounded_and_precision
  purpose: "Assert V5: 0..4 and one decimal."
  status: pending
  priority: high

* name: health_check_tick_cron_progress_bounded
  purpose: "Assert V6: 0..1 and speed label correct."
  status: pending
  priority: med
  $$$

---

## HOW TO RUN

$$$
pnpm connectome:health node_kit
$$$

---

## KNOWN GAPS

* [ ] Requires an implementation-level probe to read rendered “active step” state (test harness or DOM query).
* [ ] Energy range assumptions not finalized (may need normalization in state_store).

---

## GAPS / IDEAS / QUESTIONS

* IDEA: expose a debug-only “rendered node snapshot” object to simplify HEALTH checks.

---

---

### docs/connectome/node_kit/SYNC_Connectome_Node_Kit_Sync_Current_State.md

$$$

# node_kit — Sync: Current State

LAST_UPDATED: 2025-12-20
UPDATED_BY: Marco "Salthand" (agent)
STATUS: DESIGNING
$$$

---

## MATURITY

**Canonical (v1 intent):**

* typed node variants (Player/UI/Module/GraphQueries/Moment/Agent/TickCron)
* title prominent, file path discreet
* energy badge with deterministic bucket mapping
* internal step list with singular active highlight
* separate LLM CLI Agent nodes (Narrator, World Builder)

**In design:**

* flipped node signal source
* energy scale assumptions (0..1 vs unbounded)

---

## CURRENT STATE

Docs exist; implementation not started.

Immediate priority:

* define styling tokens and component structure
* ensure Player vs UI distinction is explicit
* implement energy glow mapping and step highlight rules

---

## TODO

* [ ] Implement node component variants and shared frame
* [ ] Implement energy bucket mapping and glow tokens
* [ ] Implement wait progress bar and tick cron ring components
* [ ] Define “flipped” signal source or keep as `?` for v1

Run:

$$$
pnpm connectome:health node_kit
$$$

---

---

### docs/connectome/node_kit/IMPLEMENTATION_Connectome_Node_Kit_Component_Map_And_Styling_Tokens.md

$$$

# node_kit — Implementation: Component Map and Styling Tokens

STATUS: DRAFT
CREATED: 2025-12-20
$$$

---

## CHAIN

$$$
PATTERNS:        ./PATTERNS_Connectome_Node_Kit_Typed_Language_Coded_Energy_Aware_Node_Rendering_Patterns.md
BEHAVIORS:       ./BEHAVIORS_Connectome_Node_Kit_Visible_Clarity_And_Trust_Effects.md
ALGORITHM:       ./ALGORITHM_Connectome_Node_Kit_Node_Rendering_Spec_And_Energy_Glow_Mapping.md
VALIDATION:      ./VALIDATION_Connectome_Node_Kit_Invariants_For_Node_Readability_And_State_Reflection.md
THIS:            IMPLEMENTATION_Connectome_Node_Kit_Component_Map_And_Styling_Tokens.md
HEALTH:          ./HEALTH_Connectome_Node_Kit_Runtime_Verification_Of_Node_State_And_Visual_Signal_Truth.md
SYNC:            ./SYNC_Connectome_Node_Kit_Sync_Current_State.md

IMPL:            app/connectome/components/node_kit/typed_connectome_node_components_with_energy_and_step_highlighting.tsx (PROPOSED)
$$$

---

## CODE STRUCTURE

$$$
app/
└── connectome/
├── components/
│   └── node_kit/
│       ├── typed_connectome_node_components_with_energy_and_step_highlighting.tsx
│       ├── connectome_node_frame_with_title_path_and_tooltip_shell.tsx
│       ├── connectome_energy_badge_bucketed_glow_and_value_formatter.tsx
│       ├── connectome_player_wait_progress_bar_with_four_second_cap.tsx
│       ├── connectome_tick_cron_circular_progress_ring_with_speed_label.tsx
│       ├── connectome_node_background_theme_tokens_by_type_and_language.ts
│       └── connectome_node_step_list_and_active_step_highlighter.tsx
$$$

### File Responsibilities

| File                                                                     | Responsibility                                         | Key Exports                                                                                         |
| ------------------------------------------------------------------------ | ------------------------------------------------------ | --------------------------------------------------------------------------------------------------- |
| `typed_connectome_node_components_with_energy_and_step_highlighting.tsx` | exports node variants used by flow_canvas              | `PlayerNode`, `UiNode`, `ModuleNode`, `GraphQueriesNode`, `MomentNode`, `AgentNode`, `TickCronNode` |
| `connectome_node_frame_with_title_path_and_tooltip_shell.tsx`            | shared rounded frame (“more circled”) + tooltip anchor | `NodeFrame`                                                                                         |
| `connectome_energy_badge_bucketed_glow_and_value_formatter.tsx`          | energy value display + deterministic glow mapping      | `EnergyBadge`                                                                                       |
| `connectome_player_wait_progress_bar_with_four_second_cap.tsx`           | wait progress bar widget                               | `PlayerWaitProgressBar`                                                                             |
| `connectome_tick_cron_circular_progress_ring_with_speed_label.tsx`       | tick cron ring widget                                  | `TickCronRing`                                                                                      |
| `connectome_node_background_theme_tokens_by_type_and_language.ts`        | token tables for background + title colors             | `themeForNodeTypeAndLanguage`                                                                       |
| `connectome_node_step_list_and_active_step_highlighter.tsx`              | renders steps list + active highlight                  | `StepList`                                                                                          |

---

## STYLING TOKENS (V1)

### Node background categories

* Player: distinct warm tint (not yellow moment tint)
* UI: cool neutral tint
* Module TS: blue tint
* Module PY: purple tint
* GraphQueries: purple tint (distinct from PY by accent ?)
* Moment: yellow tint
* Agent: green tint
* TickCron: speed-coded tint

### Energy mapping tokens

* grey bucket: low energy
* blue bucket: medium-low
* orange bucket: medium-high
* yellow bucket: high energy

---

## ENTRY POINTS

| Entry Point                           | Used By               |
| ------------------------------------- | --------------------- |
| `PlayerNode`                          | flow_canvas           |
| `ModuleNode`                          | flow_canvas           |
| `AgentNode` (Narrator, World Builder) | flow_canvas           |
| `EnergyBadge`                         | all nodes with energy |
| `StepList`                            | nodes with steps list |

---

## DATA FLOW AND DOCKING

node_kit consumes store selectors only; no writes.

$$$
flow:
name: node_kit_renders_store_projection
steps:
- flow_canvas passes view model + active focus
- node_kit renders deterministic visuals and widgets
docking_points:
- none required (HEALTH probes DOM/test harness)
$$$

---

## CONFIGURATION

| Config                     | Default                  |
| -------------------------- | ------------------------ |
| `ENERGY_BUCKET_THRESHOLDS` | [0.10, 0.30, 0.60]       |
| `WAIT_MAX_SECONDS`         | 4.0                      |
| `TITLE_PROMINENCE`         | enforced by style tokens |

---

## BIDIRECTIONAL LINKS

* each node_kit TSX should reference docs/connectome/node_kit/*
* update SYNC when energy threshold tokens change

---

## GAPS / IDEAS / QUESTIONS

* [ ] Decide whether GraphQueries node should be a ModuleNode with call_type=graphQuery styling, or a separate node type (currently separate for clarity).
* QUESTION: Do we display both “language” and “call_type” badges, or only one?
